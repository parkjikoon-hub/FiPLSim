# [Full-Path & Data-Extraction] 소화배관 및 펌프 시스템 통합 실증 시뮬레이션 명세서

## 1. 프로젝트 미션

- **핵심 목표**: 65A 교차배관 분기점부터 최말단 헤드까지의 전 구간 수리계산 및 데이터 실증.
- **분석 핵심**: 기존 용접(비드 1.5mm) 대비 형상제어 기술(비드 0mm)의 정량적 우위 입증.

## 2. 시스템 및 유동 경로 (Fluid Path)

- **계산 기점**: 65A 교차배관(Cross Main) 분기점 (입구 압력 최고 1.4 MPa) [cite: 2026-02-24].
- **조립 구조**: [가지배관] -> [분기 홀] -> [배관이음쇠(용접부)] -> [헤드이음쇠] -> [헤드] [cite: 2026-02-24].
- **관경 변화**: 50A(3개) -> 40A(2개) -> 32A(1개) -> 25A(2개) 순차 축소 [cite: 2026-02-24].
- **개별 헤드 분기 구조 (Junction Detail)**:
  - [가지배관 본체] -> [분기 홀(Hole)] -> [배관이음쇠(Welded Fitting)] -> [헤드이음쇠(Head Fitting)] -> [스프링클러 헤드] [cite: 2026-02-24].

## 3. 핵심 추출 데이터 정의 (Key Output Data) [cite: 2026-02-24]

클로드는 다음 데이터를 반드시 계산하고 사용자가 다운로드할 수 있도록 추출해야 함:

### A. 주손실 (Major Loss)

- **공식**: Darcy-Weisbach Equation 활용.
- **재질**: 탄소강 강관 (Carbon Steel, ε = 0.045mm) [cite: 2026-02-24].

### B. 부차적 손실 (Minor Loss, K-factor)

- **K1 (배관이음쇠)**: 용접 방식에 따라 변동 (기존 1.5mm 비드 적용 시 K값 상승 vs 신기술 0mm).
- **K2 (헤드이음쇠)**: 헤드 직전 연결부의 고유 저항 계수(상수) 반영 [cite: 2026-02-24].
- **K3 (분기 손실)**: 65A 교차배관에서 분기 시 발생하는 입구 손실 반영 [cite: 2026-02-24].

### C. 말단 압력 개선 데이터 (Terminal Pressure Data)

- **추출 항목**:
  1. 각 케이스별(Case A, B) 8번 말단 헤드의 최종 방수압(MPa).
  2. **개선 지표**: (Case B 압력 - Case A 압력) / Case A 압력 \* 100 (%).
  3. **안정성 지표**: 최악의 결함 위치 발생 시에도 말단 압력 0.1 MPa 유지 여부(Pass/Fail).

### D. 펌프 에너지 절감 데이터 (Pump Energy Data)

- **추출 항목**:
  1. 시스템 저항 감소에 따른 **소요 수두(Head, m)** 감소량.
  2. **소요 동력(kW) 절감량**: $P = (\rho \cdot g \cdot Q \cdot H) / \eta$ 공식 기반 비교 [cite: 2026-02-24].
  3. **연간 에너지 절감 예상치**: (ΔkW) _ (운전 시간) _ (전기요금 단가).

## E. 펌프 에너지 효율 분석 (Pump & LCC)

- **소요 동력 계산**: $$P = \frac{\rho \cdot g \cdot Q \cdot H}{\eta}$$ (η=65% 가정) [cite: 2026-02-24].
- **경제성 지표**: 신기술 적용 시의 연간 전력비용 절감액 및 펌프 다운사이징 가능성 리포트.

## 4. 시뮬레이션 시나리오 및 알고리즘

- **몬테카를로 분석**: 8개 이음쇠 중 무작위 1~3개 지점 비드 발생 시뮬레이션 (100회 반복) [cite: 2026-02-24].
- **민감도 분석**: 어느 지점의 비드가 전체 압력 손실에 가장 치명적인지 데이터로 식별.
- **최악 지점 탐색**: 시스템 전체 압력 강하에 가장 큰 영향을 주는 '임계 지점(Critical Point)' 자동 식별.
- **펌프 연동**: 실제 P-Q 성능 곡선(Wilo, ShinShin 등)과 시스템 저항 곡선의 교점 도출 [cite: 2026-02-24].

## 5. 앱 UI 및 출력 요구사항 (Streamlit)

- **대시보드**: 말단 압력 개선율(%)과 에너지 절감량(kW)을 상단에 박스 형태로 강조.
- **데이터 내보내기**:
  - **CSV/Excel 추출**: 위 3번 항목의 모든 계산 결과와 구간별 유속/압력 데이터를 파일로 저장하는 버튼 생성.
- **시각화**: 전 구간 누적 압력 손실 그래프 및 펌프 P-Q 곡선 변화도.
- **입력**: 배관 사이즈별 헤드 수, 이음쇠 간격(2.3m/3.4m), 비드 발생 확률 조절 슬라이더.
- **출력**:
  1. 전 구간 누적 압력 손실 그래프 (교차배관 분기점 ~ 8번 헤드).
  2. '비드 유무'에 따른 말단 헤드 방수압 개선율(%).
  3. 펌프 운전점 이동 시각화 (P-Q Curve).

## 6. 동적 배관망 생성 (Dynamic Network Generation) [추가: 2026-02-25]

### 6.1 동적 변수 입력부 (UI/설정)

- **양방향 가지배관 총 개수 ($n$)**: 교차배관을 중심으로 좌우로 뻗어 나가는 가지배관 수를 사용자가 직접 입력 (1 ~ 200개).
- **가지배관 사이 간격 (m)**: 교차배관 위에서 분기점 사이 거리 (1.0 ~ 10.0m).
- **가지배관당 헤드 수 ($m$)**: 각 가지배관에 일정 간격으로 설치되는 스프링클러 헤드 수 (1 ~ 50개).
- **헤드 간격 (m)**: 가지배관 위 헤드 사이 배관 길이 (선택: 1.7 / 2.1 / 2.3 / 2.5 / 3.2m).

### 6.2 배관망 자동 생성 알고리즘 (Generator)

- **교차배관 구경 자동 선정**: 전체 헤드 수($n \times m$) 기준 — 40개 이상 → 100A, 20개 이상 → 80A, 그 외 → 65A.
- **가지배관 구경 자동 선정 (NFSC 103 기반)**: 하류 헤드 수 기준 — 12개+ → 65A, 6~11개 → 50A, 4~5개 → 40A, 3개 → 32A, 1~2개 → 25A.
- **반복문 기반 동적 생성**: 사용자 입력 $n$개만큼 Node(분기점)와 가지배관 객체를 `for` 루프로 자동 Instantiate.
- **헤드 자동 배치**: 각 가지배관에 $m$개 헤드가 일정 간격으로 자동 배치.

### 6.3 교차배관 압력 계산

- **구간별 손실**: 교차배관 직진 구간의 주손실(Darcy-Weisbach) + Tee-Run 부차손실($K_{tee-run}$ = 0.3).
- **분기점 압력**: 입구 압력에서 교차배관 누적 손실을 차감하여 각 가지배관 분기점 압력 산출.
- **최악 가지배관 자동 식별**: 가장 낮은 말단 압력을 가진 가지배관(통상 가장 원격한 가지배관)을 자동 탐지.

### 6.4 메모리 및 예외 처리

- **입력 검증**: 0, 음수, 비정수, 최대치 초과 시 명확한 한글 에러 메시지 표시 (`ValidationError`).
- **최대 허용치**: 가지배관 200개, 헤드 50개/가지배관 (200×50 = 최대 10,000개 이음쇠).
- **경량 데이터 구조**: `@dataclass` 기반 최소 메모리 사용, 100개 이상 가지배관도 1초 이내 계산.
- **몬테카를로 호환**: 전체 $n \times m$개 이음쇠를 1D 인덱스로 매핑하여 무작위 결함 배치.

## 7. 개발 가이드라인

- **Comment**: 'Better Comments Next' (!, ?, TODO, \*) 적용.
- **물성치**: 탄소강 강관(ε=0.045mm), 물(ρ=998kg/m³) 적용 [cite: 2026-02-24].
- **비개발자 친화적 설계**: 모든 전문 용어에 대한 마우스 오버(Tooltip) 설명 포함.
- \*\*데이터 추출 버튼을 반드시 만들어서 엑셀로 저장할수 있도록 해야 함.
